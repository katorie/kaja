<%= partial 'sidebar' %>

<section class="contents">
  <ul id="KajaContainer">
    <% @nominees.each do |nominee| %>

    <li class="kaja">
      <div class="inner-kaja">
        <%= image_tag "profile/#{nominee.image_file}", class: 'img', alt: h(nominee.name) %>
        <h2 class="kaja-name"><%=h nominee.name %></h2>
        <a href="https://github.com/<%=h nominee.github %>" target="_blank" class="github link"><%=h nominee.github %></a>
        <a href="https://twitter.com/<%=h nominee.twitter %>" target="_blank" class="twitter link">@<%=h nominee.twitter %></a>
        <p class="text hide">
          <%=simple_format h(nominee.profile) %>
        </p>
        <p class="text hide">
          <%=simple_format h(nominee.supplement) %>
        </p>
        <h3 class="criterion hide">Kaja選定の基準や方法</h3>
        <p class="text hide"><%=h nominee.judged_by %></p>
        <h3 class="hide">Kaja投票理由</h3>
        <ul class="motive hide">
          <%=simple_format h(nominee.reason_for) %>
        </ul>
        <h2 class="community-name"><%=h nominee.community %></h2>
        <p class="text"><%=simple_format h(nominee.description) %></p>
        <p class="text hide"><%=h nominee.comment %></p>
      </div>
    </li>

  <% end %>

  </ul>
</section>
<script type="text/javascript" src="/javascripts/jquery.wookmark.min.js"></script>
<script type="text/javascript">
  $(function(){

    // **********************
    // init
    // **********************
    $.fx.interval = 30;
    var $KajaContainer = $('#KajaContainer');
    var KajaContainerWidth = 0;
    var flowtingStatus = {
      flag:0,
      scrolltop:0,
      top:0,
      left:0,
      width:0,
      margin:10,
      padding:0,
      innerPadding:10
    };

    $KajaContainer.find('.kaja').wookmark({
      autoResize: true,
      container: $KajaContainer,
      offset: 10,
      itemWidth: 280
    });

    $KajaContainer.find('.kaja').css('cursor','pointer');

    // **********************
    // event
    // **********************
    $KajaContainer.find('.kaja').on('click', function(){
      if( $(this).is('.flowting') ){
        flowtingReset( 'move' );

      } else if( flowtingStatus.flag ){
        flowtingReset();
        flowtingSet( $(this) );

      } else {
        flowtingSet( $(this) );
      }
    });

    //$(window).on('resize scroll', function(){
    $(window).on('resize', function(){
      flowtingReset( 'move' );
    });

    // **********************
    // functions
    // **********************
    function flowtingSet( $this ){

      $this = $this;
      KajaContainerWidth = $KajaContainer.width();

      var fs = flowtingStatus;
      fs.flag = 1;
      fs.scrolltop = $('body').scrollTop();
      fs.top = $this.css('top');
      fs.left = $this.css('left');
      fs.width = $this.outerWidth();
      fs.padding = parseInt( $this.css('padding') );

      $this.addClass('flowting').animate({
        top:fs.scrolltop,
        left:fs.margin,
        width:KajaContainerWidth - fs.margin * 2 - fs.padding * 2
      }, 300, 'swing', function(){
        $this.find('.hide').slideDown();
      });

      $this.find('.inner-kaja').css({
        padding:'4em'
      });

      //console.log({
      //  'scrolltop':fs.scrolltop,
      //  'top':fs.top,
      //  'left':fs.left,
      //  'margin':fs.margin,
      //  'padding':fs.padding,
      //  'width':fs.width
      //});
    }

    function flowtingReset( mode ){
      if( flowtingStatus.flag ){

        var mode = mode || 'normal';
        var $flowting = $KajaContainer.find('.flowting');
        var fs = flowtingStatus;

        $flowting.find('.hide').hide();
        $flowting.find('.inner-kaja').css({
          padding:fs.innerPadding
        });

        if( mode == 'normal'){
          $flowting.css({
            top:fs.top,
            left:fs.left,
            width:fs.width
          });
          $flowting.removeClass('flowting');

        } else if ( mode == 'move' ){
          $flowting.animate({
            top:fs.top,
            left:fs.left,
            width:fs.width
          }, 200, 'swing', function(){
            $flowting.removeClass('flowting');
          });
        }

        flowtingStatus.flag = 0;
      }
    }
  });

</script>
